<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>你不知道的JavaScript（中） | Chara</title>
    <meta name="description" content="介辈子不可能写代码的">
    <link rel="icon" href="https://blog-chara-img.oss-cn-shanghai.aliyuncs.com/blog-img/20181014154421.ico">
    
    <link rel="preload" href="/BookNote/assets/css/styles.e17c2449.css" as="style"><link rel="preload" href="/BookNote/assets/js/app.e17c2449.js" as="script"><link rel="preload" href="/BookNote/assets/css/24.styles.6d502bb7.css" as="style"><link rel="preload" href="/BookNote/assets/js/24.6d502bb7.js" as="script"><link rel="preload" href="/BookNote/assets/js/23.59613d89.js" as="script"><link rel="prefetch" href="/BookNote/assets/css/1.styles.e5382c87.css"><link rel="prefetch" href="/BookNote/assets/js/1.e5382c87.js"><link rel="prefetch" href="/BookNote/assets/css/2.styles.2ddeaa3b.css"><link rel="prefetch" href="/BookNote/assets/js/2.2ddeaa3b.js"><link rel="prefetch" href="/BookNote/assets/css/3.styles.3b165e43.css"><link rel="prefetch" href="/BookNote/assets/js/3.3b165e43.js"><link rel="prefetch" href="/BookNote/assets/js/4.2fccceae.js"><link rel="prefetch" href="/BookNote/assets/js/5.a5a1bde1.js"><link rel="prefetch" href="/BookNote/assets/js/6.4090d057.js"><link rel="prefetch" href="/BookNote/assets/js/7.61583575.js"><link rel="prefetch" href="/BookNote/assets/js/8.a7abd869.js"><link rel="prefetch" href="/BookNote/assets/js/9.5e520e66.js"><link rel="prefetch" href="/BookNote/assets/js/10.65200853.js"><link rel="prefetch" href="/BookNote/assets/js/11.95caadf1.js"><link rel="prefetch" href="/BookNote/assets/js/12.56b738c3.js"><link rel="prefetch" href="/BookNote/assets/js/13.278f015a.js"><link rel="prefetch" href="/BookNote/assets/js/14.8484d57e.js"><link rel="prefetch" href="/BookNote/assets/js/15.cf8c4aab.js"><link rel="prefetch" href="/BookNote/assets/js/16.5aa4cf23.js"><link rel="prefetch" href="/BookNote/assets/js/17.b447a8e4.js"><link rel="prefetch" href="/BookNote/assets/js/18.7171fcdb.js"><link rel="prefetch" href="/BookNote/assets/js/19.382d90d0.js"><link rel="prefetch" href="/BookNote/assets/js/20.d83c1916.js"><link rel="prefetch" href="/BookNote/assets/js/21.417e9720.js"><link rel="prefetch" href="/BookNote/assets/js/22.fc48dcc6.js">
    <link rel="stylesheet" href="/BookNote/assets/css/styles.e17c2449.css"><link rel="stylesheet" href="/BookNote/assets/css/1.styles.e5382c87.css"><link rel="stylesheet" href="/BookNote/assets/css/2.styles.2ddeaa3b.css"><link rel="stylesheet" href="/BookNote/assets/css/3.styles.3b165e43.css"><link rel="stylesheet" href="/BookNote/assets/css/24.styles.6d502bb7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BookNote/" class="home-link router-link-active"><!----> <span class="site-name">Chara</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chara's Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BookNote/blog-build/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/BookNote/booknote/" class="nav-link router-link-active">读书笔记</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KongValley" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chara's Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BookNote/blog-build/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/BookNote/booknote/" class="nav-link router-link-active">读书笔记</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KongValley" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>目录</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>你不知道的JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/BookNote/booknote/你不知道的JavaScript/上卷笔记.html" class="sidebar-link">你不知道的JavaScript（上）</a></li><li><a href="/BookNote/booknote/你不知道的JavaScript/中卷笔记.html" class="active sidebar-link">你不知道的JavaScript（中）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BookNote/booknote/你不知道的JavaScript/中卷笔记.html#第一章：类型" class="sidebar-link">第一章：类型</a></li><li class="sidebar-sub-header"><a href="/BookNote/booknote/你不知道的JavaScript/中卷笔记.html#第二章：值" class="sidebar-link">第二章：值</a></li></ul></li><li><a href="/BookNote/booknote/你不知道的JavaScript/下卷笔记.html" class="sidebar-link">你不知道的JavaScript（下）</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript核心技术开发解密</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#第一部分：作用域和闭包">第一部分：作用域和闭包</a><ul><li><a href="#第一章：类型">第一章：类型</a><ul><li><a href="#_1-1-类型">1.1 类型</a></li><li><a href="#_1-2-内置类型">1.2 内置类型</a></li><li><a href="#_1-3-值和类型">1.3 值和类型</a></li><li><a href="#_1-4-小结">1.4 小结</a></li></ul></li><li><a href="#第二章：值">第二章：值</a><ul><li><a href="#_2-1-数组">2.1 数组</a></li><li><a href="#_2-2-字符串">2.2 字符串</a></li><li><a href="#_2-3-数字">2.3 数字</a></li><li><a href="#_2-3-特殊数值">2.3 特殊数值</a></li></ul></li></ul></li></ul></div><p></p> <h1 id="第一部分：作用域和闭包"><a href="#第一部分：作用域和闭包" aria-hidden="true" class="header-anchor">#</a> 第一部分：作用域和闭包</h1> <h2 id="第一章：类型"><a href="#第一章：类型" aria-hidden="true" class="header-anchor">#</a> 第一章：类型</h2> <h3 id="_1-1-类型"><a href="#_1-1-类型" aria-hidden="true" class="header-anchor">#</a> 1.1 类型</h3> <p>要正确合理地进行类型转换（参见第 4 章），我们必须掌握 JavaScript 中的各个类型及其内在行为。几乎所有的 JavaScript 程序都会涉及某种形式的强制类型转换，处理这些情况时我们需要有充分的把握和自信。</p> <h3 id="_1-2-内置类型"><a href="#_1-2-内置类型" aria-hidden="true" class="header-anchor">#</a> 1.2 内置类型</h3> <p>JavaScript有<strong>七种</strong>内置类型：</p> <ul><li>空值（null）</li> <li>未定义（undefined）</li> <li>布尔值（boolean）</li> <li>数字（number）</li> <li>字符串（string）</li> <li>对象（object）</li> <li>符号（symbol，ES6中新增）</li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>除对象之外，其他统称为“基本类型”。</p></div> <p>我们可以用<code>typeof</code>运算符来查看值的类型，它返回的是类型的字符串值。有意思的是，这七种类型和它们的字符串值并不一一对应：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span> undefined <span class="token comment">// undefined</span>
<span class="token keyword">typeof</span> <span class="token boolean">true</span> <span class="token comment">// boolean</span>
<span class="token keyword">typeof</span> <span class="token number">42</span> <span class="token comment">// number</span>
<span class="token keyword">typeof</span> <span class="token string">'42'</span> <span class="token comment">// string</span>
<span class="token keyword">typeof</span> <span class="token punctuation">{</span> num<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span> <span class="token comment">// object</span>
<span class="token keyword">typeof</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// symbol</span>
</code></pre></div><p>以上六种类型均有同名的字符串值与之对应。</p> <p>而<code>null</code>比较特殊，typeof对它的处理存在问题：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span> <span class="token keyword">null</span> <span class="token comment">// object</span>
</code></pre></div><p>理想上返回的结果应该是<code>”null&quot;</code>，但是这个bug由来已久在，JavaScript 中已经存在了将近二十年，也许永远也不会修复，因为这牵涉到太多的 Web 系统，“修复”它会产生更多的bug，令许多系统无法正常工作。</p> <p>如果要检测<code>null</code>值的类型，可以使用以下的复合条件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">(</span><span class="token operator">!</span>a <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> a <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token comment">// 为true则为null</span>
</code></pre></div><p><code>null</code>是基础类型中唯一的一个“假值”类型（<code>falsy</code>或者<code>false-like</code>，可看第四章），<code>typeof</code>对它的返回值为<code>”object&quot;</code>。</p> <p>还有一种情况：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span> <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// function</span>
</code></pre></div><p>它实际上是<code>object</code>的一个“子类型”。具体来说，函数是“可调用对象”，它有一个内部属性<code>[[Call]]</code>，该属性使其可以被调用。<a href="http://es5.github.io/#x11.4.3" target="_blank" rel="noopener noreferrer">ECMAScript规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>确保所有函数都具有<code>”function&quot;</code>类型，并且只有函数可以具有<code>”function”</code>类型。</p> <p>函数不仅是对象，还可以拥有属性，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* .. */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数对象的 length 属性是其声明的参数的个数：</p> <div class="language-js extra-class"><pre class="language-js"><code>a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre></div><p>因为该函数声明了两个命名参数， b 和 c ，所以其 length 值为 2 。</p> <p>再来看看数组。JavaScript 支持数组，那么它是否也是一个特殊类型？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>不，数组也是对象。确切地说，它也是 object 的一个“子类型”（参见第 3 章），数组的元素按数字顺序来进行索引（而非普通像对象那样通过字符串键值），其 length 属性是元素的个数。</p> <h3 id="_1-3-值和类型"><a href="#_1-3-值和类型" aria-hidden="true" class="header-anchor">#</a> 1.3 值和类型</h3> <p>JavaScript 中的变量是没有类型的，<strong>只有值才有</strong>。变量可以随时持有任何类型的值。</p> <p>JavaScript 不做“类型强制”，也就是说，语言引擎不要求<strong>变量</strong>总是持有与其<strong>初始值</strong>同类型的值。一个变量可以现在被赋值为字符串类型值，随后又被赋值为数字类型值。</p> <p>在对变量执行<code>typeof</code>操作时，得到的结果并不是该变量的类型，而是该变量持有的值的类型，因为 JavaScript 中的变量没有类型。</p> <h4 id="undefined-和-undeclared"><a href="#undefined-和-undeclared" aria-hidden="true" class="header-anchor">#</a> undefined 和 undeclared</h4> <p>变量在未持有值的时候为 undefined 。此时 typeof 返回 &quot;undefined&quot; ：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span>
<span class="token keyword">typeof</span> a<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c<span class="token punctuation">;</span>
<span class="token comment">// later</span>
b <span class="token operator">=</span> c<span class="token punctuation">;</span>
<span class="token keyword">typeof</span> b<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
<span class="token keyword">typeof</span> c<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
</code></pre></div><p>大多数开发者倾向于将 <code>undefined</code> 等同于 <code>undeclared</code>（未声明），但在 JavaScript 中它们完全是两回事。</p> <p>已在作用域中声明但还没有赋值的变量，是 <code>undefined</code> 的。相反，还没有在作用域中声明过的变量，是<code>undeclared</code> 的。</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span>
a<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
b<span class="token punctuation">;</span> <span class="token comment">// ReferenceError: b is not defined</span>
</code></pre></div><p>浏览器对这类情况的处理很让人抓狂。上例中，“b is not defined”容易让人误以为是“b is undefined”。这里再强调一遍，“undefined”和“is not defined”是两码事。此时如果浏览器报错成“b is not found”或者“b is not declared”会更准确。</p> <p>更让人抓狂的是 typeof 处理 undeclared 变量的方式。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span>
<span class="token keyword">typeof</span> a<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
<span class="token keyword">typeof</span> b<span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
</code></pre></div><p>对于 undeclared（或者 not defined）变量， typeof 照样返回 &quot;undefined&quot; 。请注意虽然 b 是
一个 undeclared 变量，但 typeof b 并没有报错。这是因为 typeof 有一个特殊的安全防范
机制。
此时 typeof 如果能返回 undeclared（而非 undefined）的话，情况会好很多。</p> <h4 id="typeof-undeclared"><a href="#typeof-undeclared" aria-hidden="true" class="header-anchor">#</a> typeof Undeclared</h4> <p>该安全防范机制对在浏览器中运行的 JavaScript 代码来说还是很有帮助的，因为多个脚本文件会在共享的全局命名空间中加载变量。</p> <p>举个简单的例子，在程序中使用全局变量 DEBUG 作为“调试模式”的开关。在输出调试信息到控制台之前，我们会检查 DEBUG 变量是否已被声明。顶层的全局变量声明 <code>var DEBUG = true</code>只在 <code>debug.js</code> 文件中才有，而该文件只在开发和测试时才被加载到浏览器，在生产环境中不予加载。
问题是如何在程序中检查全局变量 <code>DEBUG</code> 才不会出现 <code>ReferenceError</code> 错误。这时 <code>typeof</code> 的安全防范机制就成了我们的好帮手：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这样会抛出错误</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Debugging is starting&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 这样是安全的</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token constant">DEBUG</span> <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Debugging is starting&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这不仅对用户定义的变量（比如 DEBUG ）有用，对内建的 API 也有帮助：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> atob <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">atob</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*..*/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">去掉var</p> <p>如果要为某个缺失的功能写 polyfill（即衬垫代码或者补充代码，用来补充当前运行环境中缺失的功能），一般不会用<code>var atob</code>来声明变量 <code>atob</code> 。如果在 if 语句中使用 <code>var atob</code> ，声明会被提升（hoisted，参见《你不知道的JavaScript（上卷）》 中的“作用域和闭包”部分）到作用域（即当前脚本或函数的作用域）的最顶层，即使 if 条件不成立也是如此（因为 <code>atob</code> 全局变量已经存在）。在有些浏览器中，对于一些特殊的内建全局变量（通常称为“宿主对象”，host object），这样的重复声明会报错。去掉 var 则可以防止声明被提升。</p></div> <p>还有一种不用通过 typeof 的安全防范机制的方法，就是检查所有全局变量是否是全局对象的属性，浏览器中的全局对象是 <code>window</code> 。所以前面的例子也可以这样来实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>atob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为与 <code>undeclared</code>变量不同，访问不存在的对象属性（甚至是在全局对象 <code>window</code> 上）不会产生<code>ReferenceError</code> 错误。</p> <p><code>typeof</code> 的安全防范机制对于非全局变量也很管用，虽然这种情况并不多见，也有一些开发人员不大愿意这样做。如果想让别人在他们的程序或模块中复制粘贴你的代码，就需要检查你用到的变量是否已经在宿主程序中定义过：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> helper <span class="token operator">=</span>
		<span class="token punctuation">(</span><span class="token keyword">typeof</span> FeatureXYZ <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span>
		FeatureXYZ <span class="token punctuation">:</span>
		<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*.. default feature ..*/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其他模块和程序引入 <code>doSomethingCool()</code> 时， <code>doSomethingCool()</code> 会检查 <code>FeatureXYZ</code> 变量是否已经在宿主程序中定义过；如果是，就用现成的，否则就自己定义：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个立即执行函数表达式（IIFE，参见《你不知道的JavaScript （上卷）》 “作用域和闭包”</span>
<span class="token comment">// 部分的3.3.2节）</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">FeatureXYZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*.. my XYZ feature ..*/</span> <span class="token punctuation">}</span>
	<span class="token comment">// 包含doSomethingCool(..)</span>
	<span class="token keyword">function</span> <span class="token function">doSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> helper <span class="token operator">=</span>
			<span class="token punctuation">(</span><span class="token keyword">typeof</span> FeatureXYZ <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span>
			FeatureXYZ <span class="token punctuation">:</span>
			<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*.. default feature ..*/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// ..</span>
	<span class="token punctuation">}</span>
	<span class="token function">doSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>还有一些人喜欢使用“依赖注入”（dependency injection）设计模式，就是将依赖通过参数显式地传递到函数中，如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomethingCool</span><span class="token punctuation">(</span>FeatureXYZ<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> helper <span class="token operator">=</span> FeatureXYZ <span class="token operator">||</span>
  	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*.. default feature ..*/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-4-小结"><a href="#_1-4-小结" aria-hidden="true" class="header-anchor">#</a> 1.4 小结</h3> <p>很多开发人员将 <code>undefined</code> 和 <code>undeclared</code> 混为一谈，但在 JavaScript 中它们是两码事。<code>undefined</code> 是值的一种。<code>undeclared</code> 则表示变量还没有被声明过。
遗憾的是，JavaScript 却将它们混为一谈，在我们试图访问 &quot;undeclared&quot; 变量时这样报错：<code>ReferenceError: a is not defined</code>，并且 <code>typeof</code> 对 <code>undefined</code> 和 <code>undeclared</code> 变量都返回&quot;undefined&quot; 。
然而，通过 <code>typeof</code> 的安全防范机制（阻止报错）来检查 <code>undeclared</code> 变量，有时是个不错的办法。</p> <h2 id="第二章：值"><a href="#第二章：值" aria-hidden="true" class="header-anchor">#</a> 第二章：值</h2> <h3 id="_2-1-数组"><a href="#_2-1-数组" aria-hidden="true" class="header-anchor">#</a> 2.1 数组</h3> <p>和其他强类型语言不同，在 JavaScript 中，数组可以容纳任何类型的值，可以是字符串、数字、对象（ object ），甚至是其他数组（多维数组就是通过这种方式来实现的）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 3</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>对数组声明后即可向其中加入值，不需要预先设定大小：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 0</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>使用 delete 运算符可以将单元从数组中删除，但是请注意，单元删除后，数组的 length 属性并不会发生变化。</p></div> <p>在创建“稀疏”数组（sparse array，即含有空白或空缺单元的数组）时要特别注意：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 此处没有设置a[1]单元</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><p>上面的代码可以正常运行，但其中的“空白单元”（empty slot）可能会导致出人意料的结果。 a[1]的值为 <code>undefined</code> ，但这与将其显式赋值为 <code>undefined</code>（ a[1] = <code>undefined</code> ）还是有所区别。</p> <p>数组通过数字进行索引，但有趣的是它们也是对象，所以也可以包含字符串键值和属性（但这些并不计算在数组长度内）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token string">&quot;foobar&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 1</span>
a<span class="token punctuation">[</span><span class="token string">&quot;foobar&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
a<span class="token punctuation">.</span>foobar<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre></div><p>这里有个问题需要特别注意，如果字符串键值能够被强制类型转换为十进制数字的话，它就会被当作数字索引来处理：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token string">&quot;13&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 14</span>
</code></pre></div><p>在数组中加入字符串键值 / 属性并不是一个好主意。建议使用对象来存放键值 / 属性值，用数组来存放数字索引值。</p> <h4 id="类数组"><a href="#类数组" aria-hidden="true" class="header-anchor">#</a> 类数组</h4> <p>有时需要将类数组（一组通过数字索引的值）转换为真正的数组，这一般通过数组工具函数（如 <code>indexOf(..)</code>、 <code>concat(..)</code> 、 <code>forEach(..)</code> 等）来实现。</p> <p>例如，一些 DOM 查询操作会返回 DOM 元素列表，它们并非真正意义上的数组，但十分类似。另一个例子是通过 <code>arguments</code> 对象（类数组）将函数的参数当作列表来访问（从ES6 开始已废止）。</p> <p>工具函数 <code>slice(..)</code>经常被用于这类转换：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token string">&quot;bam&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baz&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;bar&quot;,&quot;baz&quot;,&quot;bam&quot;]</span>
</code></pre></div><p>如上所示， slice() 返回参数列表（上例中是一个类数组）的一个数组复本。</p> <p>用 ES6 中的内置工具函数 <code>Array.from(..)</code> 也能实现同样的功能：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>Array.from(..)</code> 有一些非常强大的功能，将在的《你不知道的JavaScript（下卷）》的“ES6 &amp; Beyond”部分详细介绍。</p></div> <h3 id="_2-2-字符串"><a href="#_2-2-字符串" aria-hidden="true" class="header-anchor">#</a> 2.2 字符串</h3> <p>字符串经常被当成字符数组。字符串的内部实现究竟有没有使用数组并不好说，但JavaScript 中的字符串和字符数组并不是一回事，最多只是看上去相似而已。</p> <p>例如下面两个值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>字符串和数组的确很相似，它们都是类数组，都有 <code>length</code> 属性以及 <code>indexOf(..)</code> （从 ES5开始数组支持此方法）和 <code>concat(..)</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 3</span>
b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 3</span>

a<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span> <span class="token string">&quot;o&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
b<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span> <span class="token string">&quot;o&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token keyword">var</span> c <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;foobar&quot;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;f&quot;,&quot;o&quot;,&quot;o&quot;,&quot;b&quot;,&quot;a&quot;,&quot;r&quot;]</span>

a <span class="token operator">===</span> c<span class="token punctuation">;</span> <span class="token comment">// false</span>
b <span class="token operator">===</span> d<span class="token punctuation">;</span> <span class="token comment">// false</span>

a<span class="token punctuation">;</span> <span class="token comment">// &quot;foo&quot;</span>
b<span class="token punctuation">;</span> <span class="token comment">// [&quot;f&quot;,&quot;o&quot;,&quot;o&quot;]</span>
</code></pre></div><p>但这并不意味着它们都是“字符数组”，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;O&quot;</span><span class="token punctuation">;</span>
b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;O&quot;</span><span class="token punctuation">;</span>

a<span class="token punctuation">;</span> <span class="token comment">// &quot;foo&quot;</span>
b<span class="token punctuation">;</span> <span class="token comment">// [&quot;f&quot;,&quot;O&quot;,&quot;o&quot;]</span>
</code></pre></div><p>JavaScript 中字符串是不可变的，而数组是可变的。并且 <code>a[1]</code> 在 JavaScript 中并非总是合法语法，在老版本的 IE 中就不被允许（现在可以了）。正确的方法应该是 <code>a.charAt(1)</code> 。</p> <p>字符串不可变是指<strong>字符串的成员函数不会改变其原始值，而是创建并返回一个新的字符串</strong>。而数组的成员函数都是<strong>在其原始值上进行操作</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

c <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a <span class="token operator">===</span> c<span class="token punctuation">;</span> <span class="token comment">// false</span>
a<span class="token punctuation">;</span> <span class="token comment">// &quot;foo&quot;</span>
c<span class="token punctuation">;</span> <span class="token comment">// &quot;FOO&quot;</span>

b<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> <span class="token string">&quot;!&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">;</span> <span class="token comment">// [&quot;f&quot;,&quot;O&quot;,&quot;o&quot;,&quot;!&quot;]</span>
</code></pre></div><p>许多数组函数用来处理字符串很方便。虽然字符串没有这些函数，但可以通过“借用”数组的非变更方法来处理字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span>join<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
a<span class="token punctuation">.</span>map<span class="token punctuation">;</span> <span class="token comment">// undefined</span>

<span class="token keyword">var</span> c <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>join<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

c<span class="token punctuation">;</span> <span class="token comment">// &quot;f-o-o&quot;</span>
d<span class="token punctuation">;</span> <span class="token comment">// &quot;F.O.O.&quot;</span>
</code></pre></div><p>另一个不同点在于字符串反转（JavaScript 面试常见问题）。数组有一个字符串没有的可变更成员函数<code>reverse()</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>var a = &quot;foo&quot;;
var b = [&quot;f&quot;,&quot;o&quot;,&quot;o&quot;];
a.reverse; // undefined
b.reverse(); // [&quot;!&quot;,&quot;o&quot;,&quot;O&quot;,&quot;f&quot;]
b; // [&quot;f&quot;,&quot;O&quot;,&quot;o&quot;,&quot;!&quot;]
</code></pre></div><p>我们无法“借用”数组的可变更成员函数，因为<strong>字符串是不可变的</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>reverse<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回值仍然是字符串&quot;foo&quot;的一个封装对象（参见第3章）:(</span>
</code></pre></div><p>一个变通（破解）的办法是先将字符串转换为数组，待处理完后再将结果转换回字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> c <span class="token operator">=</span> a
  <span class="token comment">// 将a的值转换为字符数组</span>
  <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">)</span>
  <span class="token comment">// 将数组中的字符进行倒转</span>
  <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 将数组中的字符拼接回字符串</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

c<span class="token punctuation">;</span> <span class="token comment">// &quot;oof&quot;</span>
</code></pre></div><p>这种方法的确简单粗暴，但对<strong>简单</strong>的字符串却完全适用。</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>请注意！上述方法对于包含复杂字符（Unicode，如星号、多字节字符等）的字符串并不适用。这时则需要功能更加完备、能够处理 Unicode 的工具库。可以参考 Mathias Bynen 的 Esrever （项目地址：https://github.com/mathiasbynents/esrever）。</p></div> <p>如果需要经常以字符数组的方式来处理字符串的话，倒不如直接使用数组。这样就不用在字符串和数组之间来回折腾。可以在需要时使用 <code>join(&quot;&quot;)</code> 将字符数组转换为字符串。</p> <h3 id="_2-3-数字"><a href="#_2-3-数字" aria-hidden="true" class="header-anchor">#</a> 2.3 数字</h3> <p>JavaScript 只有一种数值类型： number （数字），包括“整数”和带小数的十进制数。此处“整数”之所以加引号是因为和其他语言不同，JavaScript 没有真正意义上的整数，这也是它一直以来为人诟病的地方。这种情况在将来或许会有所改观，但目前只有数字类型。</p> <p>JavaScript 中的“整数”就是没有小数的十进制数。所以 42.0 即等同于“整数” 42 。</p> <p>与大部分现代编程语言（包括几乎所有的脚本语言）一样，JavaScript 中的数字类型是基于 IEEE 754 标准来实现的，该标准通常也被称为“浮点数”。JavaScript 使用的是“双精度”格式（即 64 位二进制）。</p> <h4 id="数字的语法"><a href="#数字的语法" aria-hidden="true" class="header-anchor">#</a> 数字的语法</h4> <p>JavaScript 中的数字常量一般用十进制表示。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">42.3</span><span class="token punctuation">;</span>
</code></pre></div><p>数字前面的 0 可以省略：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0.42</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">.42</span><span class="token punctuation">;</span>
</code></pre></div><p>小数点后小数部分最后面的 0 也可以省略：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">42.</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><code>42.</code> 这种写法没问题，只是不常见，但从代码的可读性考虑，不建议这样写。</p></div> <p>默认情况下大部分数字都以十进制显示，小数部分最后面的 0 被省略，如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.300</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">42.0</span><span class="token punctuation">;</span>

a<span class="token punctuation">;</span> <span class="token comment">// 42.3</span>
b<span class="token punctuation">;</span> <span class="token comment">// 42</span>
</code></pre></div><p>特别大和特别小的数字默认用指数格式显示，与 <code>toExponential()</code> 函数的输出结果相同，如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">5E10</span><span class="token punctuation">;</span>
a<span class="token punctuation">;</span> <span class="token comment">// 50000000000</span>
a<span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;5e+10&quot;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">*</span> a<span class="token punctuation">;</span>
b<span class="token punctuation">;</span> <span class="token comment">// 2.5e+21</span>

<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> a<span class="token punctuation">;</span>
c<span class="token punctuation">;</span> <span class="token comment">// 2e-11</span>
</code></pre></div><p>由于数字值可以使用 Number 对象进行封装（参见第 3 章），因此数字值可以调用 Number.<code>prototype</code> 中的方法（参见第 3 章）。例如， <code>tofixed(..)</code> 方法可指定小数部分的显示位数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.59</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;43&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.6&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.59&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.590&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.5900&quot;</span>
</code></pre></div><p>请注意，上例中的输出结果实际上是给定数字的字符串形式，如果指定的小数部分的显示位数多于实际位数就用 0 补齐。</p> <p><code>toPrecision(..)</code> 方法用来指定有效数位的显示位数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42.59</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;4e+1&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;43&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.6&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.59&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.590&quot;</span>
a<span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span> <span class="token number">6</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.5900&quot;</span>
</code></pre></div><p>上面的方法不仅适用于数字变量，也适用于数字常量。不过对于 . 运算符需要给予特别注意，因为它是一个有效的数字字符，会被优先识别为数字常量的一部分，然后才是对象属性访问运算符。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 无效语法：</span>
<span class="token number">42.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SyntaxError</span>

<span class="token comment">// 下面的语法都有效：</span>
<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.000&quot;</span>
<span class="token number">0.42</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;0.420&quot;</span>
<span class="token number">42.</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.000&quot;</span>
</code></pre></div><p><code>42.tofixed(3)</code> 是无效语法，因为 <code>.</code> 被视为常量 <code>42.</code> 的一部分（如前所述），所以没有 <code>.</code> 属性访问运算符来调用 <code>tofixed</code> 方法。</p> <p><code>42..tofixed(3)</code> 则没有问题，因为第一个 <code>.</code> 被视为 number 的一部分，第二个 <code>.</code> 是属性访问运算符。只是这样看着奇怪，实际情况中也很少见。在基本类型值上直接调用的方法并不多见，不过这并不代表不好或不对。</p> <p>下面的语法也是有效的（请注意其中的空格）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">42</span> <span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;42.000&quot;</span>
</code></pre></div><p>然而对数字常量而言，这样的语法很容易引起误会，<strong>不建议使用</strong></p> <p>我们还可以用指数形式来表示较大的数字，如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> onethousand <span class="token operator">=</span> <span class="token number">1E3</span><span class="token punctuation">;</span>                    <span class="token comment">// 即 1 * 10^3</span>
<span class="token keyword">var</span> onemilliononehundredthousand <span class="token operator">=</span> <span class="token number">1.1E6</span><span class="token punctuation">;</span> <span class="token comment">// 即 1.1 * 10^6</span>
</code></pre></div><p>数字常量还可以用其他格式来表示，如二进制、八进制和十六进制。</p> <p>当前的 JavaScript 版本都支持这些格式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0xf3</span><span class="token punctuation">;</span> <span class="token comment">// 243的十六进制</span>
<span class="token number">0Xf3</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>

<span class="token number">0363</span><span class="token punctuation">;</span> <span class="token comment">// 243的八进制</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>从 ES6 开始，严格模式（strict mode）不再支持 <code>0363</code> 八进制格式（新格式如下）。 <code>0363</code> 格式在非严格模式（non-strict mode）中仍然受支持，但是考虑到将来的兼容性，最好不要再使用（我们现在使用的应该是严格模式）。</p></div> <p>ES6 支持以下新格式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0o363</span><span class="token punctuation">;</span> <span class="token comment">// 243的八进制</span>
<span class="token number">0O363</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>

<span class="token number">0b11110011</span><span class="token punctuation">;</span> <span class="token comment">// 243的二进制</span>
<span class="token number">0B11110011</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>
</code></pre></div><p>考虑到代码的易读性，不推荐使用 <code>0O363</code> 格式，因为 <code>0</code> 和大写字母 <code>O</code> 在一起容易混淆。建议尽量使用小写的 <code>0x</code> 、 <code>0b</code> 和 <code>0o</code> 。</p> <h4 id="较小的数值"><a href="#较小的数值" aria-hidden="true" class="header-anchor">#</a> 较小的数值</h4> <p>二进制浮点数最大的问题（不仅 JavaScript，所有遵循 IEEE 754 规范的语言都是如此），是会出现如下情况：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">===</span> <span class="token number">0.3</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>从数学角度来说，上面的条件判断应该为 true ，可结果为什么是 false 呢？</p> <p>简单来说，二进制浮点数中的 0.1 和 0.2 并不是十分精确，它们相加的结果并非刚好等于  0.3 ，而是一个比较接近的数字 0.30000000000000004 ，所以条件判断结果为 false 。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>有人认为，JavaScript 应该采用一种可以精确呈现数字的实现方式。一直以来出现过很多替代方案，只是都没能成为标准，以后大概也不会。这个问题看似简单，实则不然，否则早就解决了。</p></div> <p>问题是，如果一些数字无法做到完全精确，是否意味着数字类型毫无用处呢？答案当然是否定的。</p> <p>在处理带有小数的数字时需要特别注意。很多（也许是绝大多数）程序只需要处理整数，最大不超过百万或者万亿，此时使用 JavaScript 的数字类型是绝对安全的。</p> <p>如何判断 0.1 + 0.2 和 0.3 是否相等呢？</p> <p>最常见的方法是设置一个误差范围值，通常称为“机器精度”（machine epsilon），对JavaScript 的数字来说，这个值通常是 2^-52 (2.220446049250313e-16) 。</p> <p>从 ES6 开始，该值定义在 Number.EPSILON 中，我们可以直接拿来用，也可以为 ES6 之前的版本写 polyfill：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span><span class="token constant">EPSILON</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Number<span class="token punctuation">.</span><span class="token constant">EPSILON</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以使用 Number.EPSILON 来比较两个数字是否相等（在指定的误差范围内）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">numbersCloseEnoughToEqual</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span> n1 <span class="token operator">-</span> n2 <span class="token punctuation">)</span> <span class="token operator">&lt;</span> Number<span class="token punctuation">.</span><span class="token constant">EPSILON</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>

<span class="token function">numbersCloseEnoughToEqual</span><span class="token punctuation">(</span> a<span class="token punctuation">,</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// true</span>
<span class="token function">numbersCloseEnoughToEqual</span><span class="token punctuation">(</span> <span class="token number">0.0000001</span><span class="token punctuation">,</span> <span class="token number">0.0000002</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>能够呈现的最大浮点数大约是 1.798e+308 （这是一个相当大的数字），它定义在 Number.MAX_VALUE 中。最小浮点数定义在 Number.MIN_VALUE 中，大约是 5e-324 ，它不是负数，但无限接近于 0 ！</p> <h4 id="整数的安全范围"><a href="#整数的安全范围" aria-hidden="true" class="header-anchor">#</a> 整数的安全范围</h4> <p>数字的呈现方式决定了“整数”的安全值范围远远小于 Number.MAX_VALUE 。</p> <p>能够被“安全”呈现的最大整数是 2^53 - 1 ，即 9007199254740991 ，在 ES6 中被定义为Number.MAX_SAFE_INTEGER 。最小整数是 -9007199254740991 ，在 ES6 中被定义为 Number.MIN_SAFE_INTEGER 。</p> <p>有时 JavaScript 程序需要处理一些比较大的数字，如数据库中的 64 位 ID 等。由于JavaScript 的数字类型无法精确呈现 64 位数值，所以必须将它们保存（转换）为字符串。</p> <p>好在大数值操作并不常见（它们的比较操作可以通过字符串来实现）。如果确实需要对大数值进行数学运算，目前还是需要借助相关的工具库。将来 JavaScript 也许会加入对大数值的支持。</p> <h4 id="整数检测"><a href="#整数检测" aria-hidden="true" class="header-anchor">#</a> 整数检测</h4> <p>要检测一个值是否是整数，可以使用 ES6 中的 <code>Number.isInteger(..)</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span> <span class="token number">42</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span> <span class="token number">42.000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span> <span class="token number">42.3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// false</span>
</code></pre></div><p>也可以为 ES6 之前的版本 polyfill  <code>Number.isInteger(..)</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span>isInteger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Number<span class="token punctuation">.</span><span class="token function-variable function">isInteger</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> <span class="token keyword">typeof</span> num <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span> <span class="token operator">&amp;&amp;</span> num <span class="token operator">%</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要检测一个值是否是安全的整数，可以使用 ES6 中的 <code>Number.isSafeInteger(..)</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code>Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 			 <span class="token comment">// false</span>
Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// true</span>
</code></pre></div><p>可以为 ES6 之前的版本 polyfill  <code>Number.isSafeInteger(..)</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span>isSafeInteger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Number<span class="token punctuation">.</span><span class="token function-variable function">isSafeInteger</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span> num <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    	Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span> num <span class="token punctuation">)</span> <span class="token operator">&lt;=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_32-位有符号整数"><a href="#_32-位有符号整数" aria-hidden="true" class="header-anchor">#</a> 32 位有符号整数</h4> <p>虽然整数最大能够达到 53 位，但是有些数字操作（如数位操作）只适用于 32 位数字，所以这些操作中数字的安全范围就要小很多，变成从 Math.pow(-2,31) （ -2147483648 ，约 － 21 亿）到 Math.pow(2,31) - 1 （ 2147483647 ，约 21 亿）。</p> <p><code>a | 0</code> 可以将变量 a 中的数值转换为 32 位有符号整数，因为数位运算符 <code>|</code> 只适用于 32 位整数（它只关心 32 位以内的值，其他的数位将被忽略）。因此与 0 进行操作即可截取 a 中的 32 位数位。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>某些特殊的值并不是 32 位安全范围的，如 NaN 和 Infinity （下节将作相关介绍），此时会对它们执行虚拟操作（abstract operation） ToInt32 （参见第 4章），以便转换为符合数位运算符要求的 +0 值。</p></div> <h3 id="_2-3-特殊数值"><a href="#_2-3-特殊数值" aria-hidden="true" class="header-anchor">#</a> 2.3 特殊数值</h3> <h4 id="不是值的值"><a href="#不是值的值" aria-hidden="true" class="header-anchor">#</a> 不是值的值</h4> <p>undefined 类型只有一个值，即 <code>undefined</code> 。 null 类型也只有一个值，即 <code>null</code> 。它们的名称既是类型也是值。</p> <p>undefined 和 null 常被用来表示“空的”值或“不是值”的值。二者之间有一些细微的差别。例如：</p> <ul><li>null 指空值（empty value）</li> <li>undefined 指没有值（missing value）</li></ul> <p>或者：</p> <ul><li>undefined 指从未赋值</li> <li>null 指曾赋过值，但是目前没有值</li></ul> <p>null 是一个特殊关键字，不是标识符，我们不能将其当作变量来使用和赋值。然而undefined 却是一个标识符，可以被当作变量来使用和赋值。</p> <h4 id="undefined"><a href="#undefined" aria-hidden="true" class="header-anchor">#</a> undefined</h4> <p>在非严格模式下，我们可以为全局标识符 undefined 赋值（<strong>这样的设计实在是欠考虑⚠</strong>）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	undefined <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 非常糟糕的做法！</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  undefined <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// TypeError!</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在非严格和严格两种模式下，我们可以声明一个名为 undefined 的局部变量。再次强调最好不要这样做！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> undefined <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> undefined <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>永远不要重新定义 undefined 。</strong></p> <h4 id="void运算符"><a href="#void运算符" aria-hidden="true" class="header-anchor">#</a> void运算符</h4> <p>undefined 是一个内置标识符（除非被重新定义，见前面的介绍），它的值为 undefined ，通过 void 运算符即可得到该值。
表达式 void ___ 没有返回值，因此返回结果是 undefined 。 void 并不改变表达式的结果，只是让表达式不返回值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">void</span> a<span class="token punctuation">,</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 42</span>
</code></pre></div><p>按惯例我们用 <code>void 0</code> 来获得 undefined （这主要源自 C 语言，当然使用 void true 或其他void 表达式也是可以的）。 <code>void 0</code> 、 <code>void 1</code> 和 undefined 之间并没有实质上的区别。</p> <p>void 运算符在其他地方也能派上用场，比如不让表达式返回任何结果（即使其有副作用）。</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 注： APP.ready 由程序自己定义</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">APP</span><span class="token punctuation">.</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 稍后再试</span>
    <span class="token keyword">return</span> <span class="token keyword">void</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span> doSomething<span class="token punctuation">,</span><span class="token number">100</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  
	<span class="token keyword">var</span> result<span class="token punctuation">;</span>
  
  <span class="token comment">// 其他</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 现在可以了吗？</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 立即执行下一个任务</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里 <code>setTimeout(..)</code> 函数返回一个数值（计时器间隔的唯一标识符，用来取消计时），但是为了确保 if 语句不产生误报（false positive），我们要 void 掉它。</p> <p>很多开发人员喜欢分开操作，效果都一样，只是没有使用 void 运算符：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">APP</span><span class="token punctuation">.</span>ready<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 稍后再试</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span> doSomething<span class="token punctuation">,</span><span class="token number">100</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总之，如果要将代码中的值（如表达式的返回值）设为 undefined ，就可以使用 void 。这种做法并不多见，但在某些情况下却很有用。</p> <h4 id="特殊的数字"><a href="#特殊的数字" aria-hidden="true" class="header-anchor">#</a> 特殊的数字</h4> <h5 id="_1-不是数字的数字"><a href="#_1-不是数字的数字" aria-hidden="true" class="header-anchor">#</a> 1. 不是数字的数字</h5> <p>如果数学运算的操作数不是数字类型（或者无法解析为常规的十进制或十六进制数字），就无法返回一个有效的数字，这种情况下返回值为 NaN 。</p> <p>NaN 意指“不是一个数字”（not a number），这个名字容易引起误会，后面将会提到。将它理解为“无效数值”“失败数值”或者“坏数值”可能更准确些。</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>     <span class="token comment">// NaN</span>
<span class="token keyword">typeof</span> a <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>换句话说，“不是数字的数字”仍然是数字类型。这种说法可能有点绕。</p> <p>NaN 是一个“警戒值”（sentinel value，有特殊用途的常规值），用于指出数字类型中的错误情况，即“执行数学运算没有成功，这是失败后返回的结果”。</p> <p>有人也许会认为如果要检查变量的值是否为 NaN ，可以直接和 NaN 进行比较，就像比较 null 和 undefined 那样。实则不然。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

a <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
a <span class="token operator">===</span> <span class="token number">NaN</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>NaN 是一个特殊值，它和自身不相等，是唯一一个非自反（自反，reflexive，即 <code>x === x</code> 不成立）的值。而 <code>NaN != NaN</code> 为 true ，很奇怪吧？</p> <p>既然我们无法对 NaN 进行比较（结果永远为 false ），那应该怎样来判断它呢？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token function">isNaN</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>很简单，可以使用内建的全局工具函数 <code>isNaN(..)</code> 来判断一个值是否是 NaN 。</p> <p>然而操作起来并非这么容易。 <code>isNaN(..)</code> 有一个严重的缺陷，它的检查方式过于死板，就是“检查参数是否不是 NaN ，也不是数字”。但是这样做的结果并不太准确：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

a<span class="token punctuation">;</span> <span class="token comment">// NaN</span>
b<span class="token punctuation">;</span> <span class="token string">&quot;foo&quot;</span>

window<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
window<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true——晕！</span>
</code></pre></div><p>很明显 <code>&quot;foo&quot;</code> 不是一个数字，但是它也不是 NaN 。这个 bug 自 JavaScript 问世以来就一直存在，至今已超过 19 年。</p> <p>从 ES6 开始我们可以使用工具函数 <code>Number.isNaN(..)</code> 。ES6 之前的浏览器的 polyfill 如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span>isNaN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Number<span class="token punctuation">.</span><span class="token function-variable function">isNaN</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">typeof</span> n <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span> <span class="token operator">&amp;&amp;</span>
      window<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span> n <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false——好！</span>
</code></pre></div><p>实际上还有一个更简单的方法，即利用 NaN 不等于自身这个特点。 NaN 是 JavaScript 中<strong>唯一一个</strong>不等于自身的值。</p> <p>于是我们可以这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span>isNaN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Number<span class="token punctuation">.</span><span class="token function-variable function">isNaN</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> n <span class="token operator">!==</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>很多 JavaScript 程序都可能存在 NaN 方面的问题，所以我们应该尽量使用 <code>Number.isNaN(..)</code> 这样可靠的方法，无论是系统内置还是 polyfill。
如果你仍在代码中使用 <code>isNaN(..)</code> ，那么你的程序迟早会出现 bug。</p> <h5 id="_2-无穷数"><a href="#_2-无穷数" aria-hidden="true" class="header-anchor">#</a> 2. 无穷数</h5> <p>熟悉传统编译型语言（如 C）的开发人员可能都遇到过编译错误（compiler error）或者运行时错误（runtime exception），例如“除以 0”：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><p>然而在 JavaScript 中上例的结果为 Infinity （即 Number.POSITIVE_INfiNITY ）。同样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// -Infinity</span>
</code></pre></div><p>如果除法运算中的一个操作数为负数，则结果为 -Infinity （即 Number.NEGATIVE_INfiNITY ）。</p> <p>JavaScript 使用有限数字表示法（finite numeric representation，即之前介绍过的 IEEE 754浮点数），所以和纯粹的数学运算不同，JavaScript 的运算结果有可能溢出，此时结果为 <code>Infinity</code> 或者 <code>-Infinity</code> 。</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span> <span class="token comment">// 1.7976931348623157e+308</span>
a <span class="token operator">+</span> a<span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
a <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">970</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
a <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">969</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.7976931348623157e+308</span>
</code></pre></div><p>规范规定，如果数学运算（如加法）的结果超出处理范围，则由 IEEE 754 规范中的“就近取整”（round-to-nearest）模式来决定最后的结果。例如，相对于 <code>Infinity</code> ， <code>Number.MAX_VALUE + Math.pow(2, 969)</code> 与 <code>Number.MAX_VALUE</code> 更为接近，因此它被“向下取整”（round down）；而 <code>Number.MAX_VALUE + Math.pow(2, 970)</code> 与 <code>Infinity</code> 更为接近，所以它被“向上取整”（round up）。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/BookNote/booknote/你不知道的JavaScript/上卷笔记.html" class="prev">
          你不知道的JavaScript（上）
        </a></span> <span class="next"><a href="/BookNote/booknote/你不知道的JavaScript/下卷笔记.html">
          你不知道的JavaScript（下）
        </a>
        →
      </span></p></div> </div></div><div class="global-ui"><!----></div></div>
    <script src="/BookNote/assets/js/24.6d502bb7.js" defer></script><script src="/BookNote/assets/js/23.59613d89.js" defer></script><script src="/BookNote/assets/js/app.e17c2449.js" defer></script>
  </body>
</html>
